(()=>{$("#todoDate").datetimepicker({format:"DD/MM/YYYY HH:mm:ss"}),$("#editTodoDate").datetimepicker({format:"DD/MM/YYYY HH:mm:ss"});const e=document.getElementById("thingsToDo"),t=document.getElementById("thingsDone"),l=document.getElementById("thingsMissed"),i=document.getElementById("todoBox"),n=document.getElementById("doneBox"),s=document.getElementById("missedBox"),o=document.getElementById("filter"),a=document.getElementById("editTodoId"),d=document.getElementById("editTodoTitle"),c=document.getElementById("editTodoDate");function m(e,t){new Notification(e,{body:t})}function r(){fetch("http://localhost:3001/list?filter=All").then((e=>e.json())).then((e=>{!function(e){i.innerHTML="",n.innerHTML="",s.innerHTML="",e.forEach((function(e,t){let l="";l+=`\n              <li class="list-group-item d-flex align-items-center ps-0 pe-3 py-1 rounded-0 border-0 bg-transparent">\n                  <div class="form-check">\n                      <input class="form-check-input me-0" type="checkbox" value="" aria-label="..." ${"Complete"==e.status?"checked":""} disabled />\n                  </div>\n              </li>\n              <li\n                  class="list-group-item px-3 py-1 d-flex align-items-center flex-grow-1 border-0 bg-transparent mw-25" style="word-break: break-word;">\n                  <p class="lead fw-normal mb-0"><b>${e.title}</b></p>\n              </li>`;const o=e.date.split(" "),a=o[0].split("/"),d=o[1].split(":"),c=new Date(a[2],a[1]-1,a[0],d[0],d[1],d[2],0);"Complete"==e.status?(l+=`\n               <li onClick="btnDeleteClick(${e.id})" class="list-group-item p-0 d-flex align-items-center border-0 bg-transparent">\n                   <div class="btn btn-danger rounded-3 d-flex align-items-center hidden-sm hidden-xs visible-md-block visible-lg-block">\n                       <p class="small mb-0">\n                           Delete\n                       </p>\n                   </div>\n                   <div class="hidden-md hidden-lg visible-sm-block visible-xs-block">\n                       <i class="fa fa-solid fa-trash"></i>\n                   </div>\n               </li>\n               `,n.innerHTML+=`<ul class="list-group list-group-horizontal rounded-0 py-3">${l}</ul>`):(c.getTime()-(new Date).getTime())/1e3<=0&&"Complete"!=e.status?(l+=`\n                 <li class="list-group-item rounded-0 border-0 bg-transparent">\n                     <div class="text-end text-muted">\n                         <a href="#!" class="text-muted" data-mdb-toggle="tooltip m-auto" title="Start Date">\n                             <p class="small mb-0"><i class="fas fa-info-circle me-2"></i>${e.date}</p>\n                         </a>\n                     </div>\n                 </li>\n                 <li onClick="btnEditClick(${e.id})" class="list-group-item p-0 d-flex align-items-center border-0 bg-transparent mx-3">\n                      <div class="btn btn-warning rounded-3 d-flex align-items-center hidden-sm hidden-xs visible-md-block visible-lg-block" data-bs-toggle="modal" data-bs-target="#editModal">\n                         <p class="small mb-0">\n                             Edit\n                         </p>\n                      </div>\n                      <div class="hidden-md hidden-lg visible-sm-block visible-xs-block" data-bs-toggle="modal" data-bs-target="#editModal">\n                        <i class="fa fa-solid fa-edit"></i>\n                      </div>\n                 </li>\n                 <li onClick="btnCompleteClick(${e.id})" class="list-group-item p-0 d-flex align-items-center border-0 bg-transparent">\n                     <div class="btn btn-primary rounded-3 d-flex align-items-center hidden-sm hidden-xs visible-md-block visible-lg-block">\n                         <p class="small mb-0">\n                             Complete\n                         </p>\n                     </div>\n                     <div class="hidden-md hidden-lg visible-sm-block visible-xs-block">\n                        <i class="fa fa-solid fa-check"></i>\n                      </div>\n                 </li>`,s.innerHTML+=`<ul class="list-group list-group-horizontal rounded-0 py-3">${l}</ul>`):(l+=`\n               <li class="list-group-item rounded-0 border-0 bg-transparent">\n                   <div class="text-end text-muted">\n                       <a href="#!" class="text-muted" data-mdb-toggle="tooltip m-auto" title="Start Date">\n                           <p class="small mb-0"><i class="fas fa-info-circle me-2"></i>${e.date}</p>\n                       </a>\n                   </div>\n               </li>\n               <li onClick="btnEditClick(${e.id})" class="list-group-item p-0 d-flex align-items-center border-0 bg-transparent mx-3">\n                   <div class="btn btn-warning rounded-3 d-flex align-items-center hidden-sm hidden-xs visible-md-block visible-lg-block" data-bs-toggle="modal" data-bs-target="#editModal">\n                       <p class="small mb-0">\n                           Edit\n                       </p>\n                   </div>\n                   <div class="hidden-md hidden-lg visible-sm-block visible-xs-block" data-bs-toggle="modal" data-bs-target="#editModal">\n                    <i class="fa fa-solid fa-edit"></i>\n                  </div>\n               </li>\n               <li onClick="btnCompleteClick(${e.id})" class="list-group-item p-0 d-flex align-items-center border-0 bg-transparent">\n                   <div class="btn btn-primary rounded-3 d-flex align-items-center hidden-sm hidden-xs visible-md-block visible-lg-block">\n                       <p class="small mb-0">\n                           Complete\n                       </p>\n                   </div>\n                   <div class="hidden-md hidden-lg visible-sm-block visible-xs-block">\n                      <i class="fa fa-solid fa-check"></i>\n                    </div>\n               </li>`,i.innerHTML+=`<ul class="list-group list-group-horizontal rounded-0 py-3">${l}</ul>`)}))}(e),localStorage.setItem("todos",JSON.stringify(e))}))}!function(){let e=JSON.parse(localStorage.getItem("todos"));var t;null!=e&&null!=e&&e.length>0&&(t=e,fetch("http://localhost:3001/set-todo",{method:"POST",headers:{accept:"*/*","content-type":"application/json"},body:JSON.stringify({localTodo:t})})),r()}(),fetch("http://localhost:3001/list?filter=Pending").then((e=>e.json())).then((e=>{const t=new Date;e.forEach((function(e,l){const i=e.date.split(" ");if(i.length>1){const l=i[0].split("/"),n=i[1].split(":"),s=new Date(l[2],l[1]-1,l[0],n[0],n[1],n[2],0),o=(s.getTime()-t.getTime())/1e3;o<=300&&t<s&&"Complete"!=e.status?m("Reminder",`Task Due Date is In 5 Minutes or Less! Please Complete Task ${e.title}`):o<=0&&"Complete"!=e.status&&!e.notified&&(m("Task Missed",`You Missed Task ${e.title}`),fetch(`http://localhost:3001/notif/${e.id}`,{method:"PUT",headers:{accept:"*/*","content-type":"application/json"}}))}}))})),setInterval((function(){fetch("http://localhost:3001/list?filter=Pending").then((e=>e.json())).then((e=>{const t=new Date;e.forEach((function(e,l){const i=e.date.split(" ");if(i.length>1){const l=i[0].split("/"),n=i[1].split(":"),s=new Date(l[2],l[1]-1,l[0],n[0],n[1],n[2],0),o=(s.getTime()-t.getTime())/1e3;o<=300&&t<s&&"Complete"!=e.status?m("Reminder",`Task Due Date is In 5 Minutes or Less! Please Complete Task ${e.title}`):o<=0&&"Complete"!=e.status&&!e.notified&&(m("Task Missed",`You Missed Task ${e.title}`),fetch(`http://localhost:3001/notif/${e.id}`,{method:"PUT",headers:{accept:"*/*","content-type":"application/json"}}))}}))}))}),3e5),"denied"!=Notification.permission&&"granted"!=Notification.permission&&Notification.requestPermission().then((e=>{})),window.btnAddClick=function(){let e=document.getElementById("todoTitle"),t=document.getElementById("todoDate");const l=t.value.split(" ");""!=e.value?2==l.length&&3==l[0].split("/").length&&3==l[1].split(":").length?(fetch("http://localhost:3001/list",{method:"POST",headers:{accept:"*/*","content-type":"application/json"},body:JSON.stringify({title:e.value,date:t.value})}),e.value="",t.value="",r()):alert("Please Follow the Date Format!"):alert("Please Input Title!")},window.btnCompleteClick=function(e){fetch(`http://localhost:3001/list/${e}`,{method:"PUT",headers:{accept:"*/*","content-type":"application/json"}}),r()},window.btnDeleteClick=function(e){fetch(`http://localhost:3001/list/${e}`,{method:"DELETE",headers:{accept:"*/*","content-type":"application/json"}}),r()},window.btnEditClick=function(e){fetch(`http://localhost:3001/list/${e}`).then((e=>e.json())).then((e=>{a.value=e.id,d.value=e.title,c.value=e.date}))},window.filterChange=function(){const i=o.value;"All"==i?(e.style.display="block",t.style.display="block",l.style.display="block"):"Pending"==i?(e.style.display="block",t.style.display="none",l.style.display="block"):"Complete"==i&&(e.style.display="none",t.style.display="block",l.style.display="none")},window.updateTodo=function(){fetch(`http://localhost:3001/list/${a.value}`,{method:"POST",headers:{accept:"*/*","content-type":"application/json"},body:JSON.stringify({id:a.value,title:d.value,date:c.value})}),r(),document.getElementById("modalClose").click()}})();